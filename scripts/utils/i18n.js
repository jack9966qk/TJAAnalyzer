const resources = {
    en: {
        "ui.dataSource": "Data Source",
        "ui.hideControls": "Hide Controls",
        "ui.showControls": "Show Controls",
        "ui.tab.list": "Chart List",
        "ui.tab.example": "Example",
        "ui.tab.file": "Local File",
        "ui.tab.stream": "Stream Input",
        "ui.tab.test": "Test Stream",
        "ui.example.desc": "Load the built-in example chart for demonstration.",
        "ui.example.load": "Load Example Data",
        "ui.example.loaded": "Example Data Loaded",
        "ui.file.label": "Select TJA File:",
        "ui.stream.remote": "Remote Connection",
        "ui.stream.test": "Test Simulation",
        "ui.stream.desc": 'Connect to an external program that broadcasts currently played chart and judgement events. For example, <a href="https://github.com/jack9966qk/TJAAnalyzer/releases/tag/OpenTaikoPatched" target="_blank">this patched version</a> of OpenTaiko listens to connections at port 2354 (need to run as admin).',
        "ui.stream.host": "Host:",
        "ui.stream.port": "Port:",
        "ui.stream.connect": "Connect",
        "ui.stream.disconnect": "Disconnect",
        "ui.test.desc": "Simulate incoming judgement events on the currently loaded chart.",
        "ui.test.start": "Start Test Stream",
        "ui.test.stop": "Stop Test Stream",
        "ui.difficulty": "Difficulty:",
        "ui.chartOptions": "Chart Options",
        "ui.collapse": "Collapse",
        "ui.expand": "Expand",
        "ui.viewOptions": "View Options",
        "ui.noteSelection": "Note Selection",
        "ui.showJudgements": "Show Judgements",
        "ui.style": "Style:",
        "ui.style.color": "Color",
        "ui.style.underline": "Underline",
        "ui.style.text": "Text",
        "ui.coloring": "Coloring:",
        "ui.coloring.class": "Class",
        "ui.coloring.gradient": "Delta",
        "ui.filter": "Filter:",
        "ui.collapseLoops": "Collapse Loops",
        "ui.auto": "Auto",
        "ui.zoom": "Zoom:",
        "ui.showStats": "Show Note Stats",
        "ui.enableSelection": "Enable Selection",
        "ui.clearSelection": "Clear Selection",
        "ui.export": "Export Selection",
        "ui.export.chartName": "Chart Name",
        "ui.export.directory": "Directory",
        "ui.export.selectDir": "Select Export Directory",
        "ui.export.download": "Download .tja File",
        "ui.export.addToDir": "Add to Songs Directory",
        "ui.export.defaultSaveAs": "Default (Save as single file)",
        "ui.export.loops": "Loops:",
        "ui.export.gap": "Gap:",
        "ui.exportImage": "Save Image",
        "ui.annotation": "Annotation",
        "ui.autoAnnotate": "Auto Annotate",
        "ui.clearAnnotations": "Clear Annotations",
        "ui.annotation.desc": "Click on Don/Ka notes to toggle L/R annotation.",
        "ui.ese.share": "Share Current Chart",
        "ui.ese.truncated": "Showing top 100 results. Refine search to see more.",
        "ui.ese.searchPlaceholder": "Search TJA files...",
        "ui.ese.noResults": "No results found.",
        "ui.branch": "Branch:",
        "branch.normal": "Normal Chart",
        "branch.expert": "Professional Chart",
        "branch.master": "Master Chart",
        "branch.all": "All Branches",
        "ui.tab.view": "View",
        "ui.tab.judgements": "Judgements",
        "ui.tab.select": "Select",
        "ui.tab.annotate": "Annotate",
        "ui.judgement.notActive": "Judgements are only displayed when a stream is active.",
        "ui.stream.waitingStart": "Waiting for game to start...",
        "ui.judgement.branchingNotSupported": "Judgement display for chart branching is not yet supported.",
        "ui.error.branchAllMode": "Selection/annotation cannot be done when displaying multiple branches, please select a single branch to display.",
        "ui.difficulty.easy": "Easy",
        "ui.difficulty.normal": "Normal",
        "ui.difficulty.hard": "Hard",
        "ui.difficulty.oni": "Oni",
        "ui.difficulty.edit": "Oni (Ura)",
        "mode.view": "Mode: View",
        "mode.judgements": "Mode: Judgements",
        "mode.selection": "Mode: Selection",
        "mode.annotation": "Mode: Annotation",
        "status.initializing": "Initializing...",
        "status.ready": "Ready",
        "status.exampleLoaded": "Example chart loaded",
        "status.fileLoaded": "Loaded local TJA file",
        "status.receiving": "Receiving data...",
        "status.connecting": "Connecting...",
        "status.connected": "Stream: Connected",
        "status.simConnected": "Simulating Stream: Connected",
        "status.disconnected": "Disconnected",
        "status.simStopped": "Simulation Stopped",
        "status.exportSuccess": "Selection exported successfully",
        "status.exportFailed": "Failed to export selection",
        "status.exportImageSuccess": "Chart image saved successfully",
        "status.exportImageFailed": "Failed to save chart image",
        "status.parseError": "Error parsing TJA file: {error}",
        "status.noCourses": "No valid courses found in TJA file",
        "status.loadingEse": "Loading chart list from ESE...",
        "status.eseReady": "ESE chart list loaded",
        "status.eseError": "Error loading ESE data: {error}",
        "status.loadingChart": "Loading chart...",
        "status.chartLoaded": "Chart loaded from ESE",
        "stats.type": "Type",
        "stats.gap": "Gap",
        "stats.bpm": "BPM",
        "stats.hs": "HS",
        "stats.seenBpm": "Seen BPM",
        "stats.delta": "Delta",
        "stats.avgDelta": "Avg Delta",
        "judgement.perfect": "GOOD",
        "judgement.good": "OK",
        "judgement.poor": "BAD",
        "renderer.loop": "Loop x{n}",
        "renderer.judge.perfect": "GOOD",
        "renderer.judge.good": "OK",
        "renderer.judge.poor": "BAD",
    },
    zh: {
        "ui.dataSource": "数据源",
        "ui.hideControls": "隐藏控制",
        "ui.showControls": "显示控制",
        "ui.tab.list": "谱面列表",
        "ui.tab.example": "示例",
        "ui.tab.file": "本地文件",
        "ui.tab.stream": "流式输入",
        "ui.tab.test": "测试流",
        "ui.example.desc": "加载内置示例谱面以进行演示。",
        "ui.example.load": "加载示例数据",
        "ui.example.loaded": "示例数据已加载",
        "ui.file.label": "选择 TJA 文件：",
        "ui.stream.remote": "远程连接",
        "ui.stream.test": "测试模拟",
        "ui.stream.desc": '连接到广播当前游玩谱面和判定事件的外部程序。例如<a href="https://github.com/jack9966qk/TJAAnalyzer/releases/tag/OpenTaikoPatched" target="_blank">这个 OpenTaiko 修改版</a>会监听端口 2354（需要以管理员身份运行）。',
        "ui.stream.host": "主机：",
        "ui.stream.port": "端口：",
        "ui.stream.connect": "连接",
        "ui.stream.disconnect": "断开",
        "ui.test.desc": "模拟当前加载谱面的判定事件。",
        "ui.test.start": "开始测试流",
        "ui.test.stop": "停止测试流",
        "ui.difficulty": "难度：",
        "ui.chartOptions": "谱面选项",
        "ui.collapse": "折叠",
        "ui.expand": "展开",
        "ui.viewOptions": "视图选项",
        "ui.noteSelection": "音符选择",
        "ui.showJudgements": "显示判定",
        "ui.style": "样式：",
        "ui.style.color": "颜色",
        "ui.style.underline": "下划线",
        "ui.style.text": "文字",
        "ui.coloring": "着色：",
        "ui.coloring.class": "类别",
        "ui.coloring.gradient": "偏差",
        "ui.filter": "筛选：",
        "ui.collapseLoops": "折叠循环",
        "ui.auto": "自动",
        "ui.zoom": "缩放：",
        "ui.showStats": "显示音符数值",
        "ui.enableSelection": "启用选择",
        "ui.clearSelection": "清除选择",
        "ui.export": "导出选择",
        "ui.export.chartName": "谱面名称",
        "ui.export.directory": "导出目录",
        "ui.export.selectDir": "选择导出目录",
        "ui.export.download": "下载 .tja 文件",
        "ui.export.addToDir": "添加到歌曲目录",
        "ui.export.defaultSaveAs": "默认 (保存为单文件)",
        "ui.export.loops": "循环：",
        "ui.export.gap": "间隔：",
        "ui.exportImage": "保存图片",
        "ui.annotation": "标注",
        "ui.autoAnnotate": "自动标注",
        "ui.clearAnnotations": "清除标注",
        "ui.annotation.desc": "点击 咚/咔 音符以切换 L/R 标注。",
        "ui.ese.share": "分享当前谱面",
        "ui.ese.truncated": "显示前 100 条结果。请完善搜索以查看更多。",
        "ui.ese.searchPlaceholder": "搜索 TJA 文件...",
        "ui.ese.noResults": "未找到结果。",
        "ui.branch": "分歧：",
        "branch.normal": "普通谱面",
        "branch.expert": "玄人谱面",
        "branch.master": "达人谱面",
        "branch.all": "全部分歧",
        "ui.tab.view": "视图",
        "ui.tab.judgements": "判定",
        "ui.tab.select": "选择",
        "ui.tab.annotate": "标注",
        "ui.judgement.notActive": "判定仅在流活动时显示。",
        "ui.stream.waitingStart": "等待游戏开始...",
        "ui.judgement.branchingNotSupported": "暂不支持分歧谱面的判定显示。",
        "ui.error.branchAllMode": "显示多个分歧时无法进行选择/标注，请选择单个分歧进行显示。",
        "ui.difficulty.easy": "简单",
        "ui.difficulty.normal": "普通",
        "ui.difficulty.hard": "困难",
        "ui.difficulty.oni": "魔王",
        "ui.difficulty.edit": "魔王（里）",
        "mode.view": "模式：查看",
        "mode.judgements": "模式：判定",
        "mode.selection": "模式：选择",
        "mode.annotation": "模式：标注",
        "status.initializing": "初始化中...",
        "status.ready": "就绪",
        "status.exampleLoaded": "示例谱面已加载",
        "status.fileLoaded": "已加载本地 TJA 文件",
        "status.receiving": "正在接收数据...",
        "status.connecting": "正在连接...",
        "status.connected": "流：已连接",
        "status.simConnected": "模拟流：已连接",
        "status.disconnected": "已断开",
        "status.simStopped": "模拟已停止",
        "status.exportSuccess": "选择导出成功",
        "status.exportFailed": "导出选择失败",
        "status.exportImageSuccess": "图片保存成功",
        "status.exportImageFailed": "图片保存失败",
        "status.parseError": "解析 TJA 文件错误：{error}",
        "status.noCourses": "TJA 文件中未找到有效难度",
        "status.loadingEse": "正在从 ESE 加载谱面列表...",
        "status.eseReady": "ESE 谱面列表已加载",
        "status.eseError": "加载 ESE 数据错误：{error}",
        "status.loadingChart": "正在加载谱面...",
        "status.chartLoaded": "已从 ESE 加载谱面",
        "stats.type": "类型",
        "stats.gap": "间隔",
        "stats.bpm": "BPM",
        "stats.hs": "HS",
        "stats.seenBpm": "目视BPM",
        "stats.delta": "偏差",
        "stats.avgDelta": "平均偏差",
        "judgement.perfect": "良",
        "judgement.good": "可",
        "judgement.poor": "不可",
        "renderer.loop": "循环 x{n}",
        "renderer.judge.perfect": "良",
        "renderer.judge.good": "可",
        "renderer.judge.poor": "不可",
    },
    ja: {
        "ui.dataSource": "データソース",
        "ui.hideControls": "コントロールを隠す",
        "ui.showControls": "コントロールを表示",
        "ui.tab.list": "譜面リスト",
        "ui.tab.example": "サンプル",
        "ui.tab.file": "ローカルファイル",
        "ui.tab.stream": "ストリーム入力",
        "ui.tab.test": "テストストリーム",
        "ui.example.desc": "デモ用の組み込みサンプル譜面を読み込みます。",
        "ui.example.load": "サンプルデータを読み込む",
        "ui.example.loaded": "サンプルデータを読み込みました",
        "ui.file.label": "TJAファイルを選択:",
        "ui.stream.remote": "リモート接続",
        "ui.stream.test": "テストシミュレーション",
        "ui.stream.desc": '現在プレイ中の譜面や判定イベントをブロードキャストする外部プログラムに接続します。例えば、<a href="https://github.com/jack9966qk/TJAAnalyzer/releases/tag/OpenTaikoPatched" target="_blank">このOpenTaikoのパッチ適用版</a>はポート2354で接続を待ち受けます（管理者権限で実行する必要があります）。',
        "ui.stream.host": "ホスト:",
        "ui.stream.port": "ポート:",
        "ui.stream.connect": "接続",
        "ui.stream.disconnect": "切断",
        "ui.test.desc": "現在読み込まれている譜面で判定イベントをシミュレートします。",
        "ui.test.start": "テストストリームを開始",
        "ui.test.stop": "テストストリームを停止",
        "ui.difficulty": "難易度:",
        "ui.chartOptions": "譜面オプション",
        "ui.collapse": "折りたたむ",
        "ui.expand": "展開",
        "ui.viewOptions": "表示オプション",
        "ui.noteSelection": "音符選択",
        "ui.showJudgements": "判定を表示",
        "ui.style": "スタイル:",
        "ui.style.color": "色",
        "ui.style.underline": "下線",
        "ui.style.text": "文字",
        "ui.coloring": "着色:",
        "ui.coloring.class": "種類",
        "ui.coloring.gradient": "誤差",
        "ui.filter": "フィルター:",
        "ui.collapseLoops": "ループを折りたたむ",
        "ui.auto": "自動",
        "ui.zoom": "ズーム:",
        "ui.showStats": "音符情報を表示",
        "ui.enableSelection": "選択を有効化",
        "ui.clearSelection": "選択を解除",
        "ui.export": "選択範囲をエクスポート",
        "ui.export.chartName": "譜面名",
        "ui.export.directory": "ディレクトリ",
        "ui.export.selectDir": "エクスポート先ディレクトリを選択",
        "ui.export.download": ".tjaファイルをダウンロード",
        "ui.export.addToDir": "曲ディレクトリに追加",
        "ui.export.defaultSaveAs": "デフォルト (単一ファイルとして保存)",
        "ui.export.loops": "ループ:",
        "ui.export.gap": "間隔:",
        "ui.exportImage": "画像を保存",
        "ui.annotation": "注釈",
        "ui.autoAnnotate": "自動注釈",
        "ui.clearAnnotations": "注釈をクリア",
        "ui.annotation.desc": "ドン/カッ音符をクリックしてL/Rの注釈を切り替えます。",
        "ui.ese.share": "現在の譜面を共有",
        "ui.ese.truncated": "上位100件を表示しています。検索条件を絞り込んでください。",
        "ui.ese.searchPlaceholder": "TJAファイルを検索...",
        "ui.ese.noResults": "結果が見つかりませんでした。",
        "ui.branch": "分岐:",
        "branch.normal": "普通譜面",
        "branch.expert": "玄人譜面",
        "branch.master": "達人譜面",
        "branch.all": "全分岐",
        "ui.tab.view": "表示",
        "ui.tab.judgements": "判定",
        "ui.tab.select": "選択",
        "ui.tab.annotate": "注釈",
        "ui.judgement.notActive": "判定はストリームがアクティブな場合のみ表示されます。",
        "ui.stream.waitingStart": "ゲーム開始を待機中...",
        "ui.judgement.branchingNotSupported": "分岐譜面の判定表示はまだサポートされていません。",
        "ui.error.branchAllMode": "複数分岐表示中は選択/注釈ができません。単一分岐表示に切り替えてください。",
        "ui.difficulty.easy": "かんたん",
        "ui.difficulty.normal": "ふつう",
        "ui.difficulty.hard": "むずかしい",
        "ui.difficulty.oni": "おに",
        "ui.difficulty.edit": "おに（裏）",
        "mode.view": "モード: 表示",
        "mode.judgements": "モード: 判定",
        "mode.selection": "モード: 選択",
        "mode.annotation": "モード: 注釈",
        "status.initializing": "初期化中...",
        "status.ready": "準備完了",
        "status.exampleLoaded": "サンプル譜面を読み込みました",
        "status.fileLoaded": "ローカルTJAファイルを読み込みました",
        "status.receiving": "データ受信中...",
        "status.connecting": "接続中...",
        "status.connected": "ストリーム: 接続済み",
        "status.simConnected": "シミュレーション: 接続済み",
        "status.disconnected": "切断されました",
        "status.simStopped": "シミュレーション停止",
        "status.exportSuccess": "選択範囲をエクスポートしました",
        "status.exportFailed": "エクスポートに失敗しました",
        "status.exportImageSuccess": "画像を保存しました",
        "status.exportImageFailed": "画像の保存に失敗しました",
        "status.parseError": "TJAファイルの解析エラー: {error}",
        "status.noCourses": "TJAファイルに有効なコースが見つかりません",
        "status.loadingEse": "ESEから譜面リストを読み込み中...",
        "status.eseReady": "ESE譜面リストを読み込みました",
        "status.eseError": "ESEデータの読み込みエラー: {error}",
        "status.loadingChart": "譜面を読み込み中...",
        "status.chartLoaded": "ESEから譜面を読み込みました",
        "stats.type": "種類",
        "stats.gap": "間隔",
        "stats.bpm": "BPM",
        "stats.hs": "HS",
        "stats.seenBpm": "見かけBPM",
        "stats.delta": "誤差",
        "stats.avgDelta": "平均誤差",
        "judgement.perfect": "良",
        "judgement.good": "可",
        "judgement.poor": "不可",
        "renderer.loop": "ループ x{n}",
        "renderer.judge.perfect": "良",
        "renderer.judge.good": "可",
        "renderer.judge.poor": "不可",
    },
};
export class I18n {
    currentLang = "en";
    listeners = [];
    constructor() {
        const saved = localStorage.getItem("lang");
        if (saved && resources[saved]) {
            this.currentLang = saved;
        }
        else {
            const browserLang = navigator.language.split("-")[0];
            if (resources[browserLang]) {
                this.currentLang = browserLang;
            }
            if (navigator.language === "zh-CN" || navigator.language === "zh-SG") {
                this.currentLang = "zh";
            }
            if (navigator.language === "ja" || navigator.language === "ja-JP") {
                this.currentLang = "ja";
            }
        }
    }
    get language() {
        return this.currentLang;
    }
    set language(lang) {
        if (resources[lang]) {
            this.currentLang = lang;
            localStorage.setItem("lang", lang);
            this.notify();
        }
    }
    t(key, params) {
        const dict = resources[this.currentLang];
        let val = dict[key] || key;
        if (params) {
            for (const [k, v] of Object.entries(params)) {
                val = val.replace(`{${k}}`, String(v));
            }
        }
        return val;
    }
    onLanguageChange(cb) {
        this.listeners.push(cb);
    }
    notify() {
        this.listeners.forEach((cb) => {
            cb();
        });
    }
}
export const i18n = new I18n();
